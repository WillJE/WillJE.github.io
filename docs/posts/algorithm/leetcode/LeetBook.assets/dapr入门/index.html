<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#fcfcfc">
	<meta name="msapplication-TileColor" content="#fcfcfc">
<meta itemprop="name" content="">
<meta itemprop="description" content="Dapr是什么？ Dapr 是 Distributed Application Runtime （分布式应用运行时）的缩写。
工作方式 Dapr向每个计算单元注入了一个Sidecar容器/进程。Sidecar与事件触发器进行交互，并通过标准HTTP或gRPC协议与计算单元进行通信。这使Dapr能够支持所有现有和将来的编程语言，而无需您导入框架或库。
Dapr通过标准的HTTP verbs 或gRPC interface 提供内置的状态管理，可靠消息传递（至少一次传递），触发器和绑定。这使您可以遵循相同的编程范例编写无状态，有状态和类似于actor的服务。您可以自由选择一致性模型，线程模型和消息传递模式。
Dapr在Kubernetes上原生运行，也可以作为机器上的独立二进制文件，在IoT设备上运行，也可以作为容器注入到任何系统中，无论是在云端还是在本地。
Dapr使用可插拔状态存储和消息总线（例如Redis）以及gRPC来提供广泛的通信方法，包括使用gRPC的直接 dapr-to-dapr 通讯和具有保证传递和至少一次语义的异步Pub-Sub。
资料收集 官方网站  https://dapr.io/ Dapr @ GitHub   社区  dapr-cn ：Dapr中文社区，专注于dapr的文档、新闻稿本地化、新特性贡献以及中文社区推广 Dapr 中文文档库 : Dapr 中文文档库，由 dapr-cn 创建并维护的对 docs.dapr.io 内容的翻译，旨在为更熟悉中文的开发者提供一些文档上的帮助。   备注：由于dapr翻译计划已经启动，我也参与其中，我在学习笔记中翻译的部分官方文档内容都将陆续迁移过去，之后会删除学习笔记中的官方文档翻译内容。
 文档  https://github.com/dapr/docs  文章&amp;演讲 介绍性的文章：
 Announcing Distributed Application Runtime (Dapr), an open source project to make it easier for every developer to build microservice applications : 2019-10-16 重磅！微软开源微服务构建软件 Dapr : 2019-10-17，上文的中文翻译。 2020年第一次技术沙龙——体验新云原生技术OAM&amp;DAPR : 2020-01-12，参会介绍，有不少有见地的个人想法和见解，值得一读。  实践性的文章：
 Simplifying Microservices on Kubernetes with Microsoft’s Dapr : 2019-11-08，写的很细致  视频  TGI Kubernetes 105: Dapr - Distributed Application Runtime : 2020-02-14 OAM&amp;Dapr-Dapr 简介-如何帮助开发者轻松构建应用程序 : 2020-02-13 Dapr - Distributed Application Runtime - An event-driven portable runtime for | MLS1070 : 2020-01-15 Mark Russinovich Presents the Future of Cloud Native Applications with OAM and dapr | BRK3098 : 2020-01-14 Dapr, Rudr, OAM | Mark Russinovich presents next gen app development &amp; deployment (Microsoft Ignite) : 2019-11-14 Learn all about Distributed Application Runtime (Dapr), Part 1 | Azure Friday : 2019-10-25  相关资料  The Evolution of Distributed Systems on Kubernetes : Bilgin Ibryam, 讲的极好。强烈推荐 https://www.">

<meta itemprop="wordCount" content="458">
<meta itemprop="keywords" content="" /><meta property="og:title" content="" />
<meta property="og:description" content="Dapr是什么？ Dapr 是 Distributed Application Runtime （分布式应用运行时）的缩写。
工作方式 Dapr向每个计算单元注入了一个Sidecar容器/进程。Sidecar与事件触发器进行交互，并通过标准HTTP或gRPC协议与计算单元进行通信。这使Dapr能够支持所有现有和将来的编程语言，而无需您导入框架或库。
Dapr通过标准的HTTP verbs 或gRPC interface 提供内置的状态管理，可靠消息传递（至少一次传递），触发器和绑定。这使您可以遵循相同的编程范例编写无状态，有状态和类似于actor的服务。您可以自由选择一致性模型，线程模型和消息传递模式。
Dapr在Kubernetes上原生运行，也可以作为机器上的独立二进制文件，在IoT设备上运行，也可以作为容器注入到任何系统中，无论是在云端还是在本地。
Dapr使用可插拔状态存储和消息总线（例如Redis）以及gRPC来提供广泛的通信方法，包括使用gRPC的直接 dapr-to-dapr 通讯和具有保证传递和至少一次语义的异步Pub-Sub。
资料收集 官方网站  https://dapr.io/ Dapr @ GitHub   社区  dapr-cn ：Dapr中文社区，专注于dapr的文档、新闻稿本地化、新特性贡献以及中文社区推广 Dapr 中文文档库 : Dapr 中文文档库，由 dapr-cn 创建并维护的对 docs.dapr.io 内容的翻译，旨在为更熟悉中文的开发者提供一些文档上的帮助。   备注：由于dapr翻译计划已经启动，我也参与其中，我在学习笔记中翻译的部分官方文档内容都将陆续迁移过去，之后会删除学习笔记中的官方文档翻译内容。
 文档  https://github.com/dapr/docs  文章&amp;演讲 介绍性的文章：
 Announcing Distributed Application Runtime (Dapr), an open source project to make it easier for every developer to build microservice applications : 2019-10-16 重磅！微软开源微服务构建软件 Dapr : 2019-10-17，上文的中文翻译。 2020年第一次技术沙龙——体验新云原生技术OAM&amp;DAPR : 2020-01-12，参会介绍，有不少有见地的个人想法和见解，值得一读。  实践性的文章：
 Simplifying Microservices on Kubernetes with Microsoft’s Dapr : 2019-11-08，写的很细致  视频  TGI Kubernetes 105: Dapr - Distributed Application Runtime : 2020-02-14 OAM&amp;Dapr-Dapr 简介-如何帮助开发者轻松构建应用程序 : 2020-02-13 Dapr - Distributed Application Runtime - An event-driven portable runtime for | MLS1070 : 2020-01-15 Mark Russinovich Presents the Future of Cloud Native Applications with OAM and dapr | BRK3098 : 2020-01-14 Dapr, Rudr, OAM | Mark Russinovich presents next gen app development &amp; deployment (Microsoft Ignite) : 2019-11-14 Learn all about Distributed Application Runtime (Dapr), Part 1 | Azure Friday : 2019-10-25  相关资料  The Evolution of Distributed Systems on Kubernetes : Bilgin Ibryam, 讲的极好。强烈推荐 https://www." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://willje.github.io/posts/algorithm/leetcode/leetbook.assets/dapr%E5%85%A5%E9%97%A8/" /><meta property="article:section" content="posts" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="Dapr是什么？ Dapr 是 Distributed Application Runtime （分布式应用运行时）的缩写。
工作方式 Dapr向每个计算单元注入了一个Sidecar容器/进程。Sidecar与事件触发器进行交互，并通过标准HTTP或gRPC协议与计算单元进行通信。这使Dapr能够支持所有现有和将来的编程语言，而无需您导入框架或库。
Dapr通过标准的HTTP verbs 或gRPC interface 提供内置的状态管理，可靠消息传递（至少一次传递），触发器和绑定。这使您可以遵循相同的编程范例编写无状态，有状态和类似于actor的服务。您可以自由选择一致性模型，线程模型和消息传递模式。
Dapr在Kubernetes上原生运行，也可以作为机器上的独立二进制文件，在IoT设备上运行，也可以作为容器注入到任何系统中，无论是在云端还是在本地。
Dapr使用可插拔状态存储和消息总线（例如Redis）以及gRPC来提供广泛的通信方法，包括使用gRPC的直接 dapr-to-dapr 通讯和具有保证传递和至少一次语义的异步Pub-Sub。
资料收集 官方网站  https://dapr.io/ Dapr @ GitHub   社区  dapr-cn ：Dapr中文社区，专注于dapr的文档、新闻稿本地化、新特性贡献以及中文社区推广 Dapr 中文文档库 : Dapr 中文文档库，由 dapr-cn 创建并维护的对 docs.dapr.io 内容的翻译，旨在为更熟悉中文的开发者提供一些文档上的帮助。   备注：由于dapr翻译计划已经启动，我也参与其中，我在学习笔记中翻译的部分官方文档内容都将陆续迁移过去，之后会删除学习笔记中的官方文档翻译内容。
 文档  https://github.com/dapr/docs  文章&amp;演讲 介绍性的文章：
 Announcing Distributed Application Runtime (Dapr), an open source project to make it easier for every developer to build microservice applications : 2019-10-16 重磅！微软开源微服务构建软件 Dapr : 2019-10-17，上文的中文翻译。 2020年第一次技术沙龙——体验新云原生技术OAM&amp;DAPR : 2020-01-12，参会介绍，有不少有见地的个人想法和见解，值得一读。  实践性的文章：
 Simplifying Microservices on Kubernetes with Microsoft’s Dapr : 2019-11-08，写的很细致  视频  TGI Kubernetes 105: Dapr - Distributed Application Runtime : 2020-02-14 OAM&amp;Dapr-Dapr 简介-如何帮助开发者轻松构建应用程序 : 2020-02-13 Dapr - Distributed Application Runtime - An event-driven portable runtime for | MLS1070 : 2020-01-15 Mark Russinovich Presents the Future of Cloud Native Applications with OAM and dapr | BRK3098 : 2020-01-14 Dapr, Rudr, OAM | Mark Russinovich presents next gen app development &amp; deployment (Microsoft Ignite) : 2019-11-14 Learn all about Distributed Application Runtime (Dapr), Part 1 | Azure Friday : 2019-10-25  相关资料  The Evolution of Distributed Systems on Kubernetes : Bilgin Ibryam, 讲的极好。强烈推荐 https://www."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title></title>
	<link rel="stylesheet" href="https://willje.github.io/css/style.min.d3141168199607bf3a517216ce3c263814eecdbc8fca72a9a88700799a838219.css" integrity="sha256-0xQRaBmWB786UXIWzjwmOBTuzbyPynKpqIcAeZqDghk=" crossorigin="anonymous">
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
	<link rel="stylesheet" href="https://willje.github.io/css/styles.css">
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://willje.github.io">will&#39;s blog</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
  <a href="https://willje.github.io/">首页</a>
  <a href="https://willje.github.io/posts/">归档</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="menu-btn" class="hdr-btn" title="菜单"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://willje.github.io/">首页</a></li>
			<li><a href="https://willje.github.io/posts/">归档</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Jan 1, 0001</span></div>
				<h1></h1>
			</header>
			<div class="content">
				<h2 id="dapr是什么">Dapr是什么？<a href="#dapr是什么" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Dapr 是 Distributed Application Runtime （分布式应用运行时）的缩写。</p>
<p><p class="md__image">
  <img src="../dapr%e5%85%a5%e9%97%a8.assets/overview.png"
    alt="img"  />
</p>
</p>
<h2 id="工作方式">工作方式<a href="#工作方式" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Dapr向每个计算单元注入了一个Sidecar容器/进程。Sidecar与事件触发器进行交互，并通过标准HTTP或gRPC协议与计算单元进行通信。这使Dapr能够支持所有现有和将来的编程语言，而无需您导入框架或库。</p>
<p>Dapr通过标准的HTTP verbs 或gRPC interface 提供内置的状态管理，可靠消息传递（至少一次传递），触发器和绑定。这使您可以遵循相同的编程范例编写无状态，有状态和类似于actor的服务。您可以自由选择一致性模型，线程模型和消息传递模式。</p>
<p>Dapr在Kubernetes上原生运行，也可以作为机器上的独立二进制文件，在IoT设备上运行，也可以作为容器注入到任何系统中，无论是在云端还是在本地。</p>
<p>Dapr使用可插拔状态存储和消息总线（例如Redis）以及gRPC来提供广泛的通信方法，包括使用gRPC的直接 dapr-to-dapr 通讯和具有保证传递和至少一次语义的异步Pub-Sub。</p>
<h2 id="资料收集">资料收集<a href="#资料收集" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="官方网站">官方网站<a href="#官方网站" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><a href="https://dapr.io/">https://dapr.io/</a></li>
<li><a href="https://github.com/dapr/dapr" target="_blank" rel="noopener">Dapr @ GitHub</a>
</li>
</ul>
<h3 id="社区">社区<a href="#社区" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><a href="https://github.com/dapr-cn" target="_blank" rel="noopener">dapr-cn</a>
 ：Dapr中文社区，专注于dapr的文档、新闻稿本地化、新特性贡献以及中文社区推广</li>
<li><a href="https://github.com/dapr-cn/docs" target="_blank" rel="noopener">Dapr 中文文档库</a>
: Dapr 中文文档库，由 <a href="https://github.com/dapr-cn" target="_blank" rel="noopener">dapr-cn</a>
 创建并维护的对 <a href="https://docs.dapr.io/" target="_blank" rel="noopener">docs.dapr.io</a>
 内容的翻译，旨在为更熟悉中文的开发者提供一些文档上的帮助。</li>
</ul>
<blockquote>
<p>备注：由于dapr翻译计划已经启动，我也参与其中，我在学习笔记中翻译的部分官方文档内容都将陆续迁移过去，之后会删除学习笔记中的官方文档翻译内容。</p>
</blockquote>
<h3 id="文档">文档<a href="#文档" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><a href="https://github.com/dapr/docs">https://github.com/dapr/docs</a></li>
</ul>
<h3 id="文章演讲">文章&amp;演讲<a href="#文章演讲" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>介绍性的文章：</p>
<ul>
<li><a href="https://cloudblogs.microsoft.com/opensource/2019/10/16/announcing-dapr-open-source-project-build-microservice-applications/" target="_blank" rel="noopener">Announcing Distributed Application Runtime (Dapr), an open source project to make it easier for every developer to build microservice applications</a>
: 2019-10-16</li>
<li><a href="https://www.infoq.cn/article/ygNxYaTIxdBjejcyjv8Y" target="_blank" rel="noopener">重磅！微软开源微服务构建软件 Dapr</a>
: 2019-10-17，上文的中文翻译。</li>
<li><a href="https://davidlovezoe.club/wordpress/archives/721" target="_blank" rel="noopener">2020年第一次技术沙龙——体验新云原生技术OAM&amp;DAPR</a>
: 2020-01-12，参会介绍，有不少有见地的个人想法和见解，值得一读。</li>
</ul>
<p>实践性的文章：</p>
<ul>
<li><a href="https://itnext.io/simplifying-microservices-on-kubernetes-with-microsofts-dapr-distributed-application-runtime-9aece5723484" target="_blank" rel="noopener">Simplifying Microservices on Kubernetes with Microsoft’s Dapr</a>
: 2019-11-08，写的很细致</li>
</ul>
<h3 id="视频">视频<a href="#视频" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><a href="https://www.youtube.com/watch?v=17fqujSGJFM" target="_blank" rel="noopener">TGI Kubernetes 105: Dapr - Distributed Application Runtime</a>
: 2020-02-14</li>
<li><a href="https://www.youtube.com/watch?v=rmK2a7BhX-A" target="_blank" rel="noopener">OAM&amp;Dapr-Dapr 简介-如何帮助开发者轻松构建应用程序</a>
: 2020-02-13</li>
<li><a href="https://www.youtube.com/watch?v=Z12y-3HhjYA" target="_blank" rel="noopener">Dapr - Distributed Application Runtime - An event-driven portable runtime for | MLS1070</a>
: 2020-01-15</li>
<li><a href="https://www.youtube.com/watch?v=PpJhd-Jo4nM" target="_blank" rel="noopener">Mark Russinovich Presents the Future of Cloud Native Applications with OAM and dapr | BRK3098</a>
: 2020-01-14</li>
<li><a href="https://www.youtube.com/watch?v=LAUDVk8PaCY" target="_blank" rel="noopener">Dapr, Rudr, OAM | Mark Russinovich presents next gen app development &amp; deployment (Microsoft Ignite)</a>
: 2019-11-14</li>
<li><a href="https://www.youtube.com/watch?v=mPVnu4W0xzQ" target="_blank" rel="noopener">Learn all about Distributed Application Runtime (Dapr), Part 1 | Azure Friday</a>
: 2019-10-25</li>
</ul>
<h3 id="相关资料">相关资料<a href="#相关资料" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li><a href="https://www.slideshare.net/bibryam/evolution-of-distributed-systems-on-kubernetes" target="_blank" rel="noopener">The Evolution of Distributed Systems on Kubernetes</a>
 : Bilgin Ibryam, 讲的极好。强烈推荐</li>
<li><a href="https://www.slideshare.net/AbhishekGupta126/tour-of-dapr?from_action=save">https://www.slideshare.net/AbhishekGupta126/tour-of-dapr?from_action=save</a></li>
<li><a href="https://medium.com/microservices-learning/the-evolution-of-distributed-systems-fec4d35beffd" target="_blank" rel="noopener">The evolution of Distributed Systems</a>
: 另一个总结分布式系统演进的文章，比较全面，有很多典型的图片。</li>
</ul>
<h2 id="实战分析">实战分析<a href="#实战分析" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>案例来自：<a href="https://github.com/dapr/quickstarts/tree/v1.0.0/hello-world" target="_blank" rel="noopener">Hello World</a>
。演示如何在本地运行Dapr。 重点介绍服务调用和状态管理。具体可以看链接，这里记录一下，分析dapr的运行逻辑。</p>
<p>有一个nodejs应用</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">);</span>
<span class="nx">require</span><span class="p">(</span><span class="s1">&#39;isomorphic-fetch&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="kr">const</span> <span class="nx">daprPort</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DAPR_HTTP_PORT</span> <span class="o">||</span> <span class="mi">3500</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">stateStoreName</span> <span class="o">=</span> <span class="sb">`statestore`</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">stateUrl</span> <span class="o">=</span> <span class="sb">`http://localhost:</span><span class="si">${</span><span class="nx">daprPort</span><span class="si">}</span><span class="sb">/v1.0/state/</span><span class="si">${</span><span class="nx">stateStoreName</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/order&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">_req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">fetch</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">stateUrl</span><span class="si">}</span><span class="sb">/order`</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="s2">&#34;Could not get state.&#34;</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">orders</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">orders</span><span class="p">);</span>
        <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span><span class="nx">message</span><span class="o">:</span> <span class="nx">error</span><span class="p">});</span>
        <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/neworder&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">orderId</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">orderId</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Got a new order! Order ID: &#34;</span> <span class="o">+</span> <span class="nx">orderId</span><span class="p">);</span>

    <span class="kr">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">[{</span>
        <span class="nx">key</span><span class="o">:</span> <span class="s2">&#34;order&#34;</span><span class="p">,</span>
        <span class="nx">value</span><span class="o">:</span> <span class="nx">data</span>
    <span class="p">}];</span>

    <span class="nx">fetch</span><span class="p">(</span><span class="nx">stateUrl</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
        <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">state</span><span class="p">),</span>
        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&#34;Content-Type&#34;</span><span class="o">:</span> <span class="s2">&#34;application/json&#34;</span>
        <span class="p">}</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&#34;Failed to persist state.&#34;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Successfully persisted state.&#34;</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">();</span>
    <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span><span class="nx">message</span><span class="o">:</span> <span class="nx">error</span><span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="s1">&#39;/order/:id&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>  
    <span class="kr">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>      
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Invoke Delete for ID &#39;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">);</span>         

    <span class="kr">const</span> <span class="nx">deleteUrl</span> <span class="o">=</span> <span class="nx">stateUrl</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">key</span><span class="p">;</span>

    <span class="nx">fetch</span><span class="p">(</span><span class="nx">deleteUrl</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;DELETE&#34;</span><span class="p">,</span>        
        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&#34;Content-Type&#34;</span><span class="o">:</span> <span class="s2">&#34;application/json&#34;</span>
        <span class="p">}</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="s2">&#34;Failed to delete state.&#34;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Successfully deleted state.&#34;</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">send</span><span class="p">();</span>
    <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span><span class="nx">message</span><span class="o">:</span> <span class="nx">error</span><span class="p">});</span>
    <span class="p">});</span>    
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Node App listening on port </span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">!`</span><span class="p">));</span>
</code></pre></div><p>注意这里的</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">stateStoreName</span> <span class="o">=</span> <span class="sb">`statestore`</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">stateUrl</span> <span class="o">=</span> <span class="sb">`http://localhost:</span><span class="si">${</span><span class="nx">daprPort</span><span class="si">}</span><span class="sb">/v1.0/state/</span><span class="si">${</span><span class="nx">stateStoreName</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</code></pre></div><p>这个stateStoreName和我们之前通过<code>dapr init</code>生成的<code>statestore.yaml</code>保持一致的，这个文件可以去<code>$HOME$\dapr</code>目录下找到。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">dapr.io/v1alpha1</span><span class="w">
</span><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Component</span><span class="w">
</span><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">statestore</span><span class="w">
</span><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">state.redis</span><span class="w">
</span><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span><span class="w">  </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">redisHost</span><span class="w">
</span><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:6379</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">redisPassword</span><span class="w">
</span><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;&#34;</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">actorStateStore</span><span class="w">
</span><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></code></pre></div><p>看下app.py</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">dapr_port</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;DAPR_HTTP_PORT&#34;</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
<span class="n">dapr_url</span> <span class="o">=</span> <span class="s2">&#34;http://localhost:{}/v1.0/invoke/nodeapp/method/neworder&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dapr_port</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">message</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;data&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;orderId&#34;</span><span class="p">:</span> <span class="n">n</span><span class="p">}}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">dapr_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&#34;HTTP </span><span class="si">%d</span><span class="s2"> =&gt; </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                                     <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)),</span> <span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div><p>下载好依赖后通过dapr执行这个python程序，就能看到Node程序不断接收到请求</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">pip3 install requests
dapr run --app-id pythonapp cmd /c <span class="s2">&#34;python3 app.py&#34;</span>
</code></pre></div><h2 id="收藏文章">收藏文章<a href="#收藏文章" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p><a href="https://blog.51cto.com/shanyou/3017108" target="_blank" rel="noopener">Dapr能否引领云原生中间件的未来？</a>
</p>

			</div><div class="content">
	<br>
	<img src="https://raw.githubusercontent.com/WillJE/WillJE.github.io/main/docs/wetchat-qrcode.png">
</div>

			<hr class="post-end">
			<footer class="post-info">
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>458 字</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>0001-01-01 08:00 &#43;0800</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="https://willje.github.io/posts/java/lru%E7%9A%84java%E5%AE%9E%E7%8E%B0/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;新</span><br><span>LRU的JAVA实现</span>
			</a>
			<a class="prev-post" href="https://willje.github.io/posts/algorithm/leetcode/leetbook/">
				<span class="post-nav-label">旧&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span></span>
			</a>
		</div>
		<div id="comments" class="thin"><script src="https://utteranc.es/client.js"
	repo="polaris1119/polarisxu"
	issue-term="pathname"
	theme="github-light"
	crossorigin="anonymous"
	async>
</script>
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2019 - 2022 <a href="https://willje.github.io">will</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://willje.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>



	<script src="https://willje.github.io/js/main.min.4eaa15feccc672488716f0338ac605e08c7553ce0ce175e13fa00a873636bf98.js" integrity="sha256-TqoV/szGckiHFvAzisYF4Ix1U84M4XXhP6AKhzY2v5g=" crossorigin="anonymous"></script>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?224c227cd9239761ec770bc8c1fb134c";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</body>

</html>
